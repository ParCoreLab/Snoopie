# Building electron version

The instructions here are derived from [this page](https://github.com/whitphx/stlite/blob/main/packages/desktop/README.md), if something does not work you should check it first.

You will need npm to continue.

1. Build wheel for the st-click-detector module: 
```
cd ../visualizer/st-click-detector-0.1.3/
rm -rf dist
pip install build
python3 -m build
```
Now you should see a `st_click_detector-0.1.3-py3-none-any.whl` file in the `dist/` folder.

2. Set the `SNOOPIE_HOME` environment variable.

3. `cd` back to `electron_builder`. Create a symlink `streamlit_app -> ../visualizer`. And make sure `../visualizer/streamlit_app.py -> ../visualizer/parse_and_vis.py` exists.

4. Run `npm install`.

5. Run the following commands, first one should give an error but cache the wheels. The second one should not give an error:
If the first one works, no need to run the second one.
```
npm run dump streamlit_app -- -r ../visualizer/requirements.txt --no-index --find-links="$SNOOPIE_HOME/visualizer/st-click-detector-0.1.3/dist"
npm run dump streamlit_app -- -r ../visualizer/requirements.txt
```

6. The symlink automatically generated by npm is broken so create a new symlink:

```
rm build/streamlit_app
ln -s ../../visualizer build/streamlit_app
```

7. Run `npm run serve`, make sure everything works. If you get an error saying `build/stlite-manifest.json is missing`, just create it with text `{"embed":true}` 

8. Run `npm run dist`. Your build should be in `dist` folder.

## For windows build

The symlinks might be problematic, so you might want to delete `visualizer/streamlit_app.py` and copy `visualizer/parse_and_vis.py -> visualizer/streamlit_app.py`. You might also want to copy instead of symlinking when mentioned in above instructions.

## Limitations

Currently the electron build does not support unpacking/streaming zstandard files.